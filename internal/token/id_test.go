package token

import (
	"errors"
	"testing"
)

/*

eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ3NDU2YjgwNjllNDM2NWU1MTdjYTVlMjk3NTdkMWE5ZWZhNTY3YmEiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIxMTgzMTQ4NzMxOTktbm1iMzZpMGNxc2pzajJkNWs2ZzF2MjUxYmhxMmNqNHMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIxMTgzMTQ4NzMxOTktbm1iMzZpMGNxc2pzajJkNWs2ZzF2MjUxYmhxMmNqNHMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTIzMDk5NzAzNjg1NjMxMzg5NjUiLCJlbWFpbCI6ImFyaXpvdGF0c3VvQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiMjVaOF95Mnd4R1VIb1dhOWdUbWZCdyIsIm5vbmNlIjoiY2QwZjg3NzYtNjFhNy00NWU1LTg4OGMtNGIzZTk1NzY3NjAwIiwibmFtZSI6ImFyaXpvIHRvIiwicGljdHVyZSI6Imh0dHBzOi8vbGg0Lmdvb2dsZXVzZXJjb250ZW50LmNvbS8tMlh1aVFlejJVQ28vQUFBQUFBQUFBQUkvQUFBQUFBQUFBQUEvQUNIaTNyYy1PNzY4R3luTktJTzE1WmFlVmxwWkFabldhQS9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiYXJpem8iLCJmYW1pbHlfbmFtZSI6InRvIiwibG9jYWxlIjoiZW4iLCJpYXQiOjE1Nzc3NTU5NjMsImV4cCI6MTU3Nzc1OTU2M30.LZfdLxWh4OxHjtnaxgPadcxGTJFAJGGQaTrP9CQZJYgkGXxQhuXZ-KwJ8owTCqLF_BgFgCQWJ596NytDIJ02bwW8RK11cDqVr_AV5ZHYycNuLEcN4IIBkqprFp-uXofxreZ1VtqEJe-m8IEnlBP_5nuJK7k9nSD0gEcbfc_IUef9oZkw4rWC9kdavWn59NlcFhyIGHfimN_teXs8u_rzFVlmBw0qMQRFmG2uak_l4WAND5F02ZZYxt9pDddWdOOkxCs6gCK1uJiAUKpmlDBS6wvOstNbwPUIZ6mwaYxJigBZNVtODA7y-QQoYUJcSwAUoOrMjUi_0w0P2v3ntVZe4A

*/

var ErrUnknown = errors.New("unknown")

// lets try to process simple cases
var vectorParseTest = []struct {
	token string
	want  error
}{
	{ // valid token
		"eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ3NDU2YjgwNjllNDM2NWU1MTdjYTVlMjk3NTdkMWE5ZWZhNTY3YmEiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIxMTgzMTQ4NzMxOTktbm1iMzZpMGNxc2pzajJkNWs2ZzF2MjUxYmhxMmNqNHMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIxMTgzMTQ4NzMxOTktbm1iMzZpMGNxc2pzajJkNWs2ZzF2MjUxYmhxMmNqNHMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTIzMDk5NzAzNjg1NjMxMzg5NjUiLCJlbWFpbCI6ImFyaXpvdGF0c3VvQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiMjVaOF95Mnd4R1VIb1dhOWdUbWZCdyIsIm5vbmNlIjoiY2QwZjg3NzYtNjFhNy00NWU1LTg4OGMtNGIzZTk1NzY3NjAwIiwibmFtZSI6ImFyaXpvIHRvIiwicGljdHVyZSI6Imh0dHBzOi8vbGg0Lmdvb2dsZXVzZXJjb250ZW50LmNvbS8tMlh1aVFlejJVQ28vQUFBQUFBQUFBQUkvQUFBQUFBQUFBQUEvQUNIaTNyYy1PNzY4R3luTktJTzE1WmFlVmxwWkFabldhQS9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiYXJpem8iLCJmYW1pbHlfbmFtZSI6InRvIiwibG9jYWxlIjoiZW4iLCJpYXQiOjE1Nzc3NTU5NjMsImV4cCI6MTU3Nzc1OTU2M30.LZfdLxWh4OxHjtnaxgPadcxGTJFAJGGQaTrP9CQZJYgkGXxQhuXZ-KwJ8owTCqLF_BgFgCQWJ596NytDIJ02bwW8RK11cDqVr_AV5ZHYycNuLEcN4IIBkqprFp-uXofxreZ1VtqEJe-m8IEnlBP_5nuJK7k9nSD0gEcbfc_IUef9oZkw4rWC9kdavWn59NlcFhyIGHfimN_teXs8u_rzFVlmBw0qMQRFmG2uak_l4WAND5F02ZZYxt9pDddWdOOkxCs6gCK1uJiAUKpmlDBS6wvOstNbwPUIZ6mwaYxJigBZNVtODA7y-QQoYUJcSwAUoOrMjUi_0w0P2v3ntVZe4A", nil,
	},
	{ // no header token
		".eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIxMTgzMTQ4NzMxOTktbm1iMzZpMGNxc2pzajJkNWs2ZzF2MjUxYmhxMmNqNHMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIxMTgzMTQ4NzMxOTktbm1iMzZpMGNxc2pzajJkNWs2ZzF2MjUxYmhxMmNqNHMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTIzMDk5NzAzNjg1NjMxMzg5NjUiLCJlbWFpbCI6ImFyaXpvdGF0c3VvQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiMjVaOF95Mnd4R1VIb1dhOWdUbWZCdyIsIm5vbmNlIjoiY2QwZjg3NzYtNjFhNy00NWU1LTg4OGMtNGIzZTk1NzY3NjAwIiwibmFtZSI6ImFyaXpvIHRvIiwicGljdHVyZSI6Imh0dHBzOi8vbGg0Lmdvb2dsZXVzZXJjb250ZW50LmNvbS8tMlh1aVFlejJVQ28vQUFBQUFBQUFBQUkvQUFBQUFBQUFBQUEvQUNIaTNyYy1PNzY4R3luTktJTzE1WmFlVmxwWkFabldhQS9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiYXJpem8iLCJmYW1pbHlfbmFtZSI6InRvIiwibG9jYWxlIjoiZW4iLCJpYXQiOjE1Nzc3NTU5NjMsImV4cCI6MTU3Nzc1OTU2M30.LZfdLxWh4OxHjtnaxgPadcxGTJFAJGGQaTrP9CQZJYgkGXxQhuXZ-KwJ8owTCqLF_BgFgCQWJ596NytDIJ02bwW8RK11cDqVr_AV5ZHYycNuLEcN4IIBkqprFp-uXofxreZ1VtqEJe-m8IEnlBP_5nuJK7k9nSD0gEcbfc_IUef9oZkw4rWC9kdavWn59NlcFhyIGHfimN_teXs8u_rzFVlmBw0qMQRFmG2uak_l4WAND5F02ZZYxt9pDddWdOOkxCs6gCK1uJiAUKpmlDBS6wvOstNbwPUIZ6mwaYxJigBZNVtODA7y-QQoYUJcSwAUoOrMjUi_0w0P2v3ntVZe4A", ErrParse,
	},
	{ // no signature token
		"eyJhbGciOiJSUzI1NiIsImtpZCI6IjQ3NDU2YjgwNjllNDM2NWU1MTdjYTVlMjk3NTdkMWE5ZWZhNTY3YmEiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20iLCJhenAiOiIxMTgzMTQ4NzMxOTktbm1iMzZpMGNxc2pzajJkNWs2ZzF2MjUxYmhxMmNqNHMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQiOiIxMTgzMTQ4NzMxOTktbm1iMzZpMGNxc2pzajJkNWs2ZzF2MjUxYmhxMmNqNHMuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIiOiIxMTIzMDk5NzAzNjg1NjMxMzg5NjUiLCJlbWFpbCI6ImFyaXpvdGF0c3VvQGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhdF9oYXNoIjoiMjVaOF95Mnd4R1VIb1dhOWdUbWZCdyIsIm5vbmNlIjoiY2QwZjg3NzYtNjFhNy00NWU1LTg4OGMtNGIzZTk1NzY3NjAwIiwibmFtZSI6ImFyaXpvIHRvIiwicGljdHVyZSI6Imh0dHBzOi8vbGg0Lmdvb2dsZXVzZXJjb250ZW50LmNvbS8tMlh1aVFlejJVQ28vQUFBQUFBQUFBQUkvQUFBQUFBQUFBQUEvQUNIaTNyYy1PNzY4R3luTktJTzE1WmFlVmxwWkFabldhQS9zOTYtYy9waG90by5qcGciLCJnaXZlbl9uYW1lIjoiYXJpem8iLCJmYW1pbHlfbmFtZSI6InRvIiwibG9jYWxlIjoiZW4iLCJpYXQiOjE1Nzc3NTU5NjMsImV4cCI6MTU3Nzc1OTU2M30.", ErrParse,
	},
	{ // empty string
		"", ErrParse,
	},
	{ // near empty string
		".", ErrParse,
	},
	{ // near empty string
		"..", ErrParse,
	},
	{ // invalid near empty string
		"...", ErrParse,
	},
	{ // invalid near empty string
		"a.x.a", ErrUnknown,
	},
	{ // invalid near empty string
		"", ErrParse,
	},
}

func TestParsing(t *testing.T) {
	for i, v := range vectorParseTest {
		_, err := Parse(v.token)
		//	fmt.Printf("testing [%d] want: %v err: %v\n", i, v.want, err)

		switch {
		case v.want == ErrUnknown && err != nil:
			// ErrUknown is just any errors
		case v.want != err:
			t.Fatalf("test #%d failed error: %v vs expected: %v\n", i, err, v.want)
		}
	}
}
